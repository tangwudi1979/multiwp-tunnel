# 常见问答与一些深入思考

这里汇总一些在部署与分享过程中被问到的问题，也记录下对方案合理性的进一步思考。

---

## ❓ 为什么不直接用 CDN 的全缓存模式？

很多人第一反应是：「既然都用了 Cloudflare，为什么不把所有页面都 Cache Everything？」

其实已经用了：
- APO 已经是对 WordPress 最优的全站缓存解决方案，能最大化命中率。
- 但总会有一些动态场景（比如提交评论），需要回源。

所以还是需要有多活源站，确保在缓存失效或特定请求时依然可用。

---

## ❓ 多活节点之间为什么不用 MySQL 主从或者多主？

对于这种跨境多地域架构：
- 传统的 MySQL 主从在跨国网络上延迟太高，也可能因为丢包导致复制中断，需要手动维护。
- 而多主方案（如 Galera Cluster / Group Replication）需要更低延迟的内部网络，通常不适合跨国部署。

同时对个人博客而言：
- 数据库写入非常少（几乎只在发布或有人评论时），没有必要承担多主的复杂度。
- 用单向 `rsync` 同步导出的 `wordpress.sql` 文件，反而是更简单、可控、稳定的方式。

所以选择了这种弱一致架构。

---

## ❓ 为什么媒体文件不直接在节点间同步？

因为：
- 所有图片都已经使用云端图床（我这里是基于Cloudflare R2实现）。
- 只要数据库中存的链接都是云端地址，节点根本不需要本地存图，天然共享。

其实这也是最容易被忽视的多活前提条件。

---

## ❓ 评论如何保证不丢？

目前通过 Cloudflare Worker 在用户提交评论时：
- 同时向多个节点(我这里是家宽主节点和VPS节点)的 API 发起写入请求。
- 未来就算有更多节点也能同时写入。

这样就算单个节点网络波动，也能大概率保证至少一个节点写入成功，减少评论丢失风险。

当然这并不是分布式事务(会有极小概率个别节点写失败)，但对于博客这种弱一致性场景已经足够。

---

## ❓ 为什么没有用专业的探活监控系统？

因为：
- curl + Bark 最简单。
- 不需要为了这个小体量拉一套 Prometheus + Grafana + Blackbox。

不过未来可以用 GitHub Actions 定时探活，并在失败时自动切换到全站静态。

---

## ❓ 如果所有节点都挂了怎么办？

就算所有节点都挂了：
- 还可以手动在 Cloudflare 仪表盘里设置 Page Rule，302 重定向到 Pages 上的静态站点。
- 这比复杂的自动化更稳定，也避免自动切换误触。

极端场景下人工兜底，反而是个人站点最务实的选择。

---

## ❓ 这个方案适合所有人吗？

并不适合。
- 如果是流量非常小的博客，其实只要开个 Pages 全静态就好了。
- 如果要非常严格的业务一致性（比如会员系统、支付），就需要数据库级别的分布式架构。

这个方案更适合：
- 个人技术向博客
- 少量动态写入（如评论）
- 追求超高可用的 geek

---

## ❌ 曾尝试的方案

- 尝试在主节点通过定期执行脚本，使用 SQL 查询 `wp_posts` 与 `wp_comments` 的最新修改时间，
  以判断是否需要导出数据库。
- 但实际测试发现：
  - 有些评论插件或 WordPress 自身写入 `wp_commentmeta` 也会代表有新评论，但未被检测到。
  - 导致日志显示“无数据库变化”，但实际已有新评论写入。
- 最终决定放弃此仅基于时间戳的判断逻辑，改为手动或者定期无条件导出。

---

## 🚀 小结

多活方案不是银弹，但对弱一致性要求的场景非常优雅。

未来也会在这个架构上继续迭代，比如：
- 自动化探活切换
- Worker 多节点写入
- 更复杂的缓存和队列方案

---

## 📌 回到 README

👉 [返回多活方案总览](../README.md)

---